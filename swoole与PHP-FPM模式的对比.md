# swoole与PHP-FPM模式的对比

## 传统的web开发模式

PHP web开发采用的方式是LAMP/LNMP架构，即Linux、Nginx，Mysql和PHP。这里以nginx来举例，大致结构为：

![WeChat101660dbf4b24ba5b8a5f5bc530b892d.png](https://i.loli.net/2019/07/16/5d2d398e77c4466536.png)

当请求进入时，web server将请求转交给PHP-FPM,PHP-FPM是一个进程池架构的FastCGI服务,内置PHP解释器。FPM负责解释执行PHP文件生成响应，最终返回给web server，展现至前端。PHP文件中实现了许多业务逻辑，包括Mysql和Nosql的访问，调用第三方应用等等。

这样的结构php-fpm和nginx的配合已经运行得足够好,但是由于php-fpm本身是同步阻塞进程模型,在请求结束后释放所有的资源（包括框架初始化创建的一系列对象）,导致PHP进程“空转”（创建<-->销毁<-->创建）消耗大量的CPU资源,从而导致单机的吞吐能力有限。

每次请求处理的过程都意味着一次PHP文件解析，环境设置等不必要的耗时操作PHP进程处理完即销毁，无法在PHP程序中使用连接池等技术实现性能优化


## swoole的运行模式

针对传统架构的问题，swoole从PHP扩展出发，解决了上述问题，对于swoole的进程模型，我们刚刚已经学过了。

相比于传统架构，Swoole进程模型最大的特点在于其多线程Reactor模式处理网络请求，使得其能轻松应对大量连接。

除此之外的优点还包括：

全异步非阻塞，占用资源开销小，程序执行效率高（协程）

程序运行只解析加载一次PHP文件，避免每次请求的重复加载

进程常驻，使得连接池和请求之间信息传递等的实现成为可能 
